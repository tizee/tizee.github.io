{"componentChunkName":"component---src-templates-post-jsx","path":"/post/fd75741b5209fbb3a3af90b8190e57e1","result":{"data":{"post":{"id":"eb2ac992-7359-50e0-bec3-a1b6d32344e3","excerpt":"update: \"2020-2-28\"\ncomment: migrate to gatsby-remark-embedder  Sometime we need to embed external link to a code sandbox or playground like…","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"embedding in blog\",\n  \"date\": \"2019-09-27\",\n  \"category\": \"blog\",\n  \"tags\": [\"gatsby plugin\", \"github\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"update: \\\"2020-2-28\\\"\\ncomment: migrate to gatsby-remark-embedder \"), mdx(\"p\", null, \"Sometime we need to embed external link to a code sandbox or playground like \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"CodePen\"), \" to illustrate an idea. However, this is not supported by markdown and gatsby's markdown transformer. To achieve embedding, we need to get the embedding \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"iframe\"), \" code from the platform or just construct the code by ourselves but the process is tedious.\"), mdx(\"p\", null, \"But there are some platforms that support embedding their application by wrapped inside a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"<iframe>\"), \" tag. As far as I know, they are \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developers.google.com/youtube/player_parameters\"\n  }), \"Youtube\"), \", \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.instagram.com/developer/embedding/\"\n  }), \"Instagram\"), \", \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://developer.twitter.com/en/docs/twitter-for-websites/embedded-tweets/overview\"\n  }), \"Twitter\"), \",\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://codepen.io/embeds\"\n  }), \"CodePen\"), \" and etc.\"), mdx(\"p\", null, \"In fact, I have never dive into this aspect before. My opinion about this was that this is just a pleasant way to embed or quote something from other websites and I've never wondered how can we put contents inside a iframe by using url parameters to control its display or function. I never think about it could have its own specification and even a standard format.\"), mdx(\"p\", null, \"The gatsby plugin \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.gatsbyjs.org/packages/@raae/gatsby-remark-oembed/\"\n  }), \"gatsby-remark-oembed\"), \" help me embed content from some mainstream platforms that support \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://oembed.com/\"\n  }), \"oEmbed format\"), \".\"), mdx(\"p\", null, \"However, soon I realized the plugin wasn't that easy to use for me because by now I've been living in China, a country blocks its people from visiting some great international websites for the sake of national security.\"), mdx(\"h3\", null, \"Socks5 Proxy feature\"), mdx(\"p\", null, \"Now I know that it lacks the proxy feature so in order to solve this problem, I just need to fork the repository and add this feature. Let's do it.\\nBy reading the source code of \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/raae/gatsby-remark-oembed\"\n  }), \"gatsby-remark-oembed\"), \", I found that the plugin uses \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/axios/axios\"\n  }), \"axios\"), \" to request API urls exposed by platforms.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// node_modules/@raae/gatsby-remark-oembed/utils/fetchOembed.js\\nconst axios = require(\\\"axios\\\");\\n\\nconst fetchOembed = async endpoint => {\\n  const response = await axios.get(endpoint.url, {\\n    params: {\\n      format: \\\"json\\\",\\n      ...endpoint.params\\n    }\\n  });\\n  return response.data;\\n};\\n\\nmodule.exports = fetchOembed;\\n\")), mdx(\"p\", null, \"The axios is a promise based http client for browser and node.js and it only supports http/https proxy by setting corresponding http/https agent provided by node.js module http and https.\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"390px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"71.42857142857143%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAACYElEQVQ4y3VT51rjMBDMu0BIISGJu1wkx90pJBQf7eD932JuJOcLcB/8GFuWtaPZ3dlBWMQI2z1GvsIsiDBcBRjbIUbEld2vx45ei9O++ALuWwJWkuMmVLj2EwwuLG66CawshWxCLFWKqRORJDIBEzvBmP9H/J55ElMGTTyNmJCYUMjl0qMQ32BwxcdY3xIW8IsWiyjDPNnjJlrjOgh4kcRKxrwgMIEXi8/gHh5VBmcMhpZPFTEiecD+9QPZvoOdPSPavsBSCuE2Q97VUIccolljpaQh16U5E5H4k1ArtCP4yRblXQcn3cHOn+CXLeJdhmUSM3XW0hFMUWDqhSZweCIZfiH7RhiQsOleUT08Q1R3sNb3fN8i2RdUmxv4lYIoSsTt8UeyU8pBrzDeINkcWMc7Bj7ATRsE6yMsmcJKU8xExJqGmPkRVuzqiJ3/lXBCwig9mpS9/BFB+w6PSpyyYuoKfp2yrorpJ+fm/JqyfkwcrZA1ZLrblw/E9Q6LeA+n+AOXRPJYInusDNShgJ3KU1N+UHhl9eadeymCcgNbFpjFBeaqMT7Tai6XrlFilPG8NvX/RN8ItYGXIscipAfpv6ngm76cC71ekzhlFrp+NLND7y0d+tE9o/dnv+4JCZ8NEO0TVPuItMyRZRvE6h5B1sGt/sItO3b8DdGmY5NqNm8DUW7NMFiyMN8hSzXQs6jNPXJjeOoAuXvjZNSwqNgSFVWWVF3DWddYxlTKc2O3H8FrXxqYdSANjEI9+FPO5kpu4TXvRpFqnlDdPpOk4sHUkN2EnGG3N7luSF9f1vX01vgH8wvO50JWcRsAAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"axiosSourceCode\",\n    \"title\": \"sourceCode\",\n    \"src\": \"/static/06f721dcc66d4317836f008987f1451d/727ba/axios.png\",\n    \"srcSet\": [\"/static/06f721dcc66d4317836f008987f1451d/a4837/axios.png 98w\", \"/static/06f721dcc66d4317836f008987f1451d/cb9a0/axios.png 195w\", \"/static/06f721dcc66d4317836f008987f1451d/727ba/axios.png 390w\", \"/static/06f721dcc66d4317836f008987f1451d/78a22/axios.png 585w\", \"/static/06f721dcc66d4317836f008987f1451d/a1792/axios.png 780w\", \"/static/06f721dcc66d4317836f008987f1451d/46115/axios.png 1290w\"],\n    \"sizes\": \"(max-width: 390px) 100vw, 390px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"So is it possible to implement socks5 using node.js built-in module \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://nodejs.org/api/http.html#http_class_http_agent\"\n  }), \"http\"), \" http agent?\\uD83E\\uDD14 I googled to find whether someone had solved this problem and here comes the enhancement plugin named \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/TooTallNate/node-socks-proxy-agent\"\n  }), \"socks-proxy-agent\"), \" that implemented socks proxy using \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http.agent\"), \" class and other socks client plugin.\"), mdx(\"p\", null, \"Chirs posted an article \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://medium.com/@paynoattn/using-a-socks-proxy-to-make-requests-in-node-js-ba5125c7999f\"\n  }), \"using-a-socks-proxy-to-make-requests-in-node-js-\"), \" about this on medium, it helped me to solve the problem directly without knowing its lower details. And there is also an \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/axios/axios/issues/636\"\n  }), \"issue\"), \" about axios socks5 proxy on github.\"), mdx(\"p\", null, \"The solution for \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-plugin-oembed\"), \" is simple. Adding a few lines of code and the problem is solved but has it really been solved?\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-javascript\"\n  }), \"// modified: node_modules/@raae/gatsby-remark-oembed/utils/fetchOembed.js\\nconst axios = require(\\\"axios\\\");\\nconst SocksProxyAgent = require(\\\"socks-proxy-agent\\\");\\n\\nconst fetchOembed = async endpoint => {\\n  // highlight-range{1-4}\\n  const proxyHost = \\\"127.0.0.1\\\", proxyPort = \\\"9999\\\";\\n  const proxyOptions = `socks5://${proxyHost}:${proxyPort}`;\\n  const httpAgent = new SocksProxyAgent(proxyOptions);\\n  const httpsAgent = httpAgent;\\n  const response = await axios.get(endpoint.url, {\\n    params: {\\n      format: \\\"json\\\",\\n      ...endpoint.params\\n    },\\n    // highlight-start\\n    httpAgent: httpAgent,\\n    httpsAgent: httpsAgent\\n    // highlight-end\\n  });\\n  return response.data;\\n};\\n\\nmodule.exports = fetchOembed;\\n\")), mdx(\"p\", null, \"The above snippet is just a workaround for me so it doesn't support custom host and port.\"), mdx(\"p\", null, \"Besides, I have to install the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"gatsby-plugin-oembed\"), \" from my own local forked repository in case that each time the files under \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"node_modules\"), \" are restore to default each time run yarn scripts.\"), mdx(\"p\", null, \"But before I add this proxy feature, I need to check out whether it works or not.\"), mdx(\"p\", null, mdx(\"iframe\", _extends({\n    parentName: \"p\"\n  }, {\n    \"width\": \"100%\",\n    \"height\": 315,\n    \"src\": \"https://www.youtube-nocookie.com/embed/QH2-TGUlwu4?rel=0\",\n    \"frameBorder\": \"0\",\n    \"allow\": \"accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture\",\n    \"allowFullScreen\": true\n  }))), mdx(\"h3\", null, \"pull request\"), mdx(\"p\", null, \"Here is the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/raae/gatsby-remark-oembed/pull/87\"\n  }), \"pull request\"), \" and it seems not pass due to some configurations in test files.\\nSo I came to twitter to contact the author \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://twitter.com/raae\"\n  }), \"Benedicte Raae\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","fields":{"date":"2019-09-27","title":"embedding in blog","category":"blog","tags":["gatsby plugin","github"],"slug":"fd75741b5209fbb3a3af90b8190e57e1"},"timeToRead":2,"tableOfContents":{"items":[{"url":"#socks5-proxy-feature","title":"Socks5 Proxy feature"},{"url":"#pull-request","title":"pull request"}]}}},"pageContext":{"id":"eb2ac992-7359-50e0-bec3-a1b6d32344e3","previous":{"post":{"id":"9c2f0df4-09a0-5981-84a3-39926397a766","parent":{"id":"090840c9-bbe3-5074-91a2-9b26d9df8f78"},"excerpt":"Have you calculated how much time you spend on reading or writing each day? Or from a longer time scale like a week or a month even a year…","slug":"d890fd029695168ddfb96582515a3bf7","title":"Writing and reading","tags":["writing","reading","English"],"category":"thoughts","date":"2019-09-26"}},"next":{"post":{"id":"77f05d55-9802-5c74-b3c7-47b31b21238f","parent":{"id":"e7cb6fd2-d55e-5652-88b7-c5e67c4173da"},"excerpt":"Here is the link to windows'  mklink","slug":"814b60543720893cafbe2659fbf30f90","title":"create soft link in windows","tags":["windows","how-to"],"category":"snippets","date":"2019-09-29"}}}}}